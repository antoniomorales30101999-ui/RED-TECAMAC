<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RED TECAMAC - Sistema Dual</title>

    <script>
        var claveCorrecta = "Tecamac2026*";
        if (sessionStorage.getItem("acceso_permitido") !== "true") {
            var intento = prompt("üîê ACCESO\nIngrese clave:");
            if (intento === claveCorrecta) { sessionStorage.setItem("acceso_permitido", "true"); }
            else { window.location.href = "https://google.com"; }
        }
    </script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    
    <style>
        body { background-color: #f4f7f6; color: #333; font-family: 'Segoe UI', sans-serif; padding: 15px; }
        .app-header { background: linear-gradient(135deg, #004a99 0%, #002d5f 100%); color: white; padding: 20px; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; margin-bottom: 20px; text-align: center; }
        
        .control-panel { max-width: 900px; margin: 0 auto 20px auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .section-title { font-weight: bold; color: #004a99; margin-bottom: 10px; display: block; font-size: 1rem; text-transform: uppercase; letter-spacing: 1px; }
        
        /* Buscador Normal (Ahora Arriba) */
        #normalSearch { width: 100%; border: 2px solid #004a99; border-radius: 50px; padding: 12px 25px; font-size: 1.1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05); outline: none; margin-bottom: 10px; }
        
        /* Buscador Lote (Ahora Abajo) */
        #batchSearch { width: 100%; border: 2px dashed #cbd5e0; border-radius: 12px; padding: 12px; font-size: 0.9rem; transition: 0.3s; }
        #batchSearch:focus { border-color: #004a99; background: #f8fbff; outline: none; }
        
        #contenedorTabla { display: none; background: white; border-radius: 15px; padding: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .table thead th { background-color: #f8f9fa !important; color: #004a99 !important; font-size: 0.75rem; border-bottom: 2px solid #dee2e6 !important; }
        mark { background: #fff3cd !important; color: #856404 !important; font-weight: bold; }
        .badge-count { background: #004a99; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; display: inline-block; margin-top: 5px; }
    </style>
</head>
<body>

<div class="app-header">
    <h3>üõ∞Ô∏è SISTEMA CORE TECAMAC</h3>
</div>

<div class="control-panel">
    <label class="section-title">üîç Buscador R√°pido (OLT, QR, Calle...):</label>
    <input type="text" id="normalSearch" placeholder="Escriba cualquier dato para buscar..." autocomplete="off">
    
    <hr class="my-4">

    <label class="section-title">üìã Extractor de Cuentas (Pegar coincidencias de texto):</label>
    <textarea id="batchSearch" rows="2" placeholder="Pegue aqu√≠ textos de WhatsApp o listas de cuentas..."></textarea>
    <div id="statusInfo" class="badge-count mt-2" style="display:none;"></div>
</div>

<div id="mensajeVacio" class="text-center text-muted mt-5">
    <p>Utilice los buscadores superiores para filtrar los registros de la red.</p>
</div>

<div id="contenedorTabla">
    <table id="tablaMaestra" class="table table-hover w-100">
        <thead>
            <tr>
                <th>Cuenta</th><th>QR</th><th>OLT</th><th>FSP</th>
                <th>Lat</th><th>Lon</th><th>Ubicaci√≥n</th><th>Puerto</th>
            </tr>
        </thead>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js"></script>
<script src="https://cdn.datatables.net/plug-ins/1.13.6/sorting/natural.js"></script>

<script>
    var table;
    $(document).ready(function() {
        Papa.parse("datos.csv", {
            download: true,
            header: false,
            skipEmptyLines: true,
            complete: function(results) {
                table = $('#tablaMaestra').DataTable({
                    data: results.data,
                    dom: 'rtip',
                    pageLength: 20,
                    columnDefs: [{ type: 'natural', targets: 7 }],
                    order: [[7, 'asc']],
                    language: {
                        "info": "Coincidencias encontradas: _TOTAL_",
                        "paginate": { "next": "Sig", "previous": "Ant" }
                    }
                });

                // L√ìGICA BUSCADOR NORMAL (ARRIBA)
                $('#normalSearch').on('keyup input', function() {
                    $('#batchSearch').val(''); // Limpia el otro buscador
                    $('#statusInfo').hide();
                    var val = $(this).val().trim();
                    if (val === "") {
                        ocultarTabla();
                    } else {
                        mostrarTabla();
                        table.column(0).search(''); // Limpia filtro de columna
                        table.search(val).draw();
                    }
                });

                // L√ìGICA EXTRACTOR (ABAJO)
                $('#batchSearch').on('input', function() {
                    $('#normalSearch').val(''); // Limpia el otro buscador
                    var rawText = $(this).val();
                    var cuentas = rawText.match(/\d{5,12}/g);

                    if (cuentas) {
                        var cuentasUnicas = [...new Set(cuentas)];
                        var regexFiltro = cuentasUnicas.join('|');
                        mostrarTabla();
                        $('#statusInfo').show().text(cuentasUnicas.length + " cuentas extra√≠das");
                        table.column(0).search(regexFiltro, true, false).draw();
                    } else {
                        ocultarTabla();
                        table.search('').columns().search('').draw();
                    }
                });

                function mostrarTabla() { $('#contenedorTabla').show(); $('#mensajeVacio').hide(); }
                function ocultarTabla() { $('#contenedorTabla').hide(); $('#mensajeVacio').show(); table.search('').columns().search('').draw(); }

                // MARCADOR DE TEXTO
                table.on('draw', function() {
                    var body = $(table.table().body());
                    body.unmark();
                    var v1 = $('#normalSearch').val();
                    var v2 = $('#batchSearch').val().match(/\d{5,12}/g);
                    if (v1 && v1.length > 2) body.mark(v1);
                    if (v2) v2.forEach(w => body.mark(w));
                });
            }
        });
    });
</script>

</body>
</html>
