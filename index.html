<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Red Tecamac</title>

    <script>
        var claveCorrecta = "Tecamac2026*";
        if (sessionStorage.getItem("acceso_permitido") !== "true") {
            var intento = prompt("üîê ACCESO T√âCNICO\nIngrese clave:");
            if (intento === claveCorrecta) { sessionStorage.setItem("acceso_permitido", "true"); }
            else { alert("Denegado"); window.location.href = "https://google.com"; }
        }
    </script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js"></script>

    <style>
        body { background-color: #0d1117; color: #c9d1d9; font-family: 'Segoe UI', sans-serif; }
        .app-header { background: #161b22; border-bottom: 2px solid #58a6ff; padding: 15px; text-align: center; }
        
        /* DISE√ëO DE BUSCADOR PRINCIPAL */
        .dataTables_filter { width: 100%; text-align: center !important; padding: 20px 10px 10px 10px; }
        .dataTables_filter input {
            background-color: #0d1117 !important;
            border: 2px solid #58a6ff !important;
            border-radius: 12px !important;
            color: #fff !important;
            padding: 15px !important;
            width: 100% !important;
            max-width: 700px;
            font-size: 1.2rem;
            box-shadow: 0 0 15px rgba(88, 166, 255, 0.2);
        }

        /* √ÅREA DE LOGS (AHORA ABAJO DEL BUSCADOR) */
        .log-search-area {
            background: #161b22;
            border-radius: 12px;
            margin: 0 15px 15px 15px;
            padding: 15px;
            border: 1px solid #30363d;
        }
        #logInput {
            background: #0d1117;
            border: 1px solid #3fb950;
            color: #3fb950;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }

        .main-card { background: #161b22; border-radius: 12px; margin: 0 15px 15px 15px; padding: 10px; border: 1px solid #30363d; }
        .table { color: #c9d1d9 !important; border-color: #30363d !important; }
        .table thead th { background-color: #0d1117 !important; color: #58a6ff !important; font-size: 0.75rem; border-bottom: 2px solid #30363d !important; }
        
        mark { background: #ffeb3b !important; color: #000 !important; border-radius: 2px; }
        .dataTables_info { color: #8b949e; font-size: 0.8rem; padding: 10px; }
    </style>
</head>
<body>

<div class="app-header">
    <h1 class="h5 mb-0">üì° DISTRITO TECAMAC </h1>
</div>

<div id="filter_wrapper"></div>

<div class="log-search-area">
    <label class="form-label small text-secondary fw-bold">üìã PEGADO DE LOG O TEXTO COMPLETO:</label>
    <textarea class="form-control" id="logInput" rows="2" placeholder="Pegue aqu√≠ el texto largo para un filtrado inteligente..."></textarea>
</div>

<div class="main-card">
    <table id="tablaMaestra" class="table table-hover w-100">
        <thead>
            <tr>
                <th>Cuenta</th><th>QR</th><th>OLT</th><th>FSP</th>
                <th>Latitud</th><th>Longitud</th><th>Ubicaci√≥n</th><th>Puerto</th>
            </tr>
        </thead>
    </table>
</div>

<script>
    var table;

    $(document).ready(function() {
        Papa.parse("datos.csv", {
            download: true,
            header: false,
            skipEmptyLines: true,
            complete: function(results) {
                table = $('#tablaMaestra').DataTable({
                    data: results.data,
                    deferRender: true,
                    scrollY: "50vh",
                    scrollCollapse: true,
                    language: {
                        "search": "",
                        "searchPlaceholder": "üîç BUSCAR DATO ESPEC√çFICO...",
                        "info": "Registros cargados: _TOTAL_",
                        "loadingRecords": "Sincronizando red..."
                    },
                    dom: 'firt'
                });

                // Mover el buscador nativo al contenedor superior
                $('.dataTables_filter').detach().appendTo('#filter_wrapper');

                // L√≥gica de pegado de texto largo
                $('#logInput').on('keyup change', function() {
                    var val = $(this).val();
                    var keywords = val.replace(/\t/g, ' ').split(' ').filter(w => w.length > 1);
                    table.search(keywords.join(' ')).draw();
                });

                // Marcado de texto
                table.on('draw', function() {
                    var body = $(table.table().body());
                    body.unmark();
                    var searchVal = table.search();
                    if(searchVal) {
                        searchVal.split(' ').forEach(word => {
                            if(word.length > 2) body.mark(word);
                        });
                    }
                });
            }
        });
    });
</script>

</body>
</html>
