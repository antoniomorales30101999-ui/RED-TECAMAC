<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Red tecamac</title>

    <script>
        var claveCorrecta = "Tecamac2026*";
        if (sessionStorage.getItem("acceso_permitido") !== "true") {
            var intento = prompt("üîê ACCESO T√âCNICO\nIngrese clave:");
            if (intento === claveCorrecta) { sessionStorage.setItem("acceso_permitido", "true"); }
            else { alert("Denegado"); window.location.href = "https://google.com"; }
        }
    </script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js"></script>

    <style>
        body { background-color: #f0f2f5; color: #333; font-family: sans-serif; padding: 15px; }
        .app-header { text-align: center; margin-bottom: 20px; }
        .app-header h1 { color: #004a99; font-size: 1.4rem; font-weight: bold; }

        /* BUSCADOR PRINCIPAL */
        .search-box {
            background: #fff; border: 2px solid #004a99; border-radius: 10px;
            padding: 15px; width: 100%; font-size: 1.2rem; margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); outline: none;
        }

        /* √ÅREA DE LOGS */
        .log-container { background: #e9ecef; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #ced4da; }
        #logInput { background: #fff; border: 1px solid #adb5bd; color: #28a745; width: 100%; font-family: monospace; padding: 10px; border-radius: 5px; outline: none; }

        /* CONTENEDOR DE TABLA (OCULTO POR DEFECTO) */
        #contenedorTabla { display: none; background: #fff; border-radius: 10px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        .table thead th { background-color: #f8f9fa !important; color: #004a99 !important; border-bottom: 2px solid #004a99 !important; font-size: 0.8rem; }
        mark { background: #fff3cd !important; color: #856404 !important; font-weight: bold; }
        
        .placeholder-text { text-align: center; color: #999; margin-top: 60px; font-size: 1.1rem; }
    </style>
</head>
<body>

<div class="app-header">
    <h1>üõ∞Ô∏è CONSULTA RED TECAMAC</h1>
</div>

<input type="text" id="mainSearch" class="search-box" placeholder="üîç Buscar por Cuenta, QR, Nombre...">

<div class="log-container">
    <label class="small text-muted fw-bold mb-1">üìã PEGADO DE LOG (TEXTO LARGO):</label>
    <textarea id="logInput" rows="2" placeholder="Pegue el log aqu√≠..."></textarea>
</div>

<div id="mensajeVacio" class="placeholder-text">
    <p>Esperando datos de b√∫squeda...</p>
</div>

<div id="contenedorTabla">
    <table id="tablaMaestra" class="table table-hover w-100">
        <thead>
            <tr>
                <th>Cuenta</th><th>QR</th><th>OLT</th><th>FSP</th>
                <th>Lat</th><th>Lon</th><th>Ubicaci√≥n</th><th>Puerto</th>
            </tr>
        </thead>
    </table>
</div>

<script>
    var table;
    $(document).ready(function() {
        Papa.parse("datos.csv", {
            download: true,
            header: false,
            skipEmptyLines: true,
            complete: function(results) {
                table = $('#tablaMaestra').DataTable({
                    data: results.data,
                    deferRender: true,
                    scrollY: "50vh",
                    scrollCollapse: true,
                    dom: 'rtip',
                    language: { "info": "Encontrados: _TOTAL_ registros" }
                });

                function procesarBusqueda() {
                    var textoNormal = $('#mainSearch').val().trim();
                    var textoLog = $('#logInput').val().trim();

                    // Si ambos campos est√°n vac√≠os, ocultamos todo
                    if (textoNormal === "" && textoLog === "") {
                        $('#contenedorTabla').hide();
                        $('#mensajeVacio').show();
                        table.search('').draw(); // Reseteamos la b√∫squeda interna
                    } else {
                        // Si hay texto, mostramos tabla y filtramos
                        $('#contenedorTabla').show();
                        $('#mensajeVacio').hide();

                        // Prioridad al log si tiene contenido, si no el buscador normal
                        var consulta = "";
                        if (textoLog !== "") {
                            consulta = textoLog.replace(/\t/g, ' ').split(' ').filter(w => w.length > 1).join(' ');
                        } else {
                            consulta = textoNormal;
                        }
                        
                        table.search(consulta).draw();
                    }
                }

                $('#mainSearch').on('keyup input', procesarBusqueda);
                $('#logInput').on('keyup change input', procesarBusqueda);

                table.on('draw', function() {
                    var body = $(table.table().body());
                    body.unmark();
                    var searchVal = table.search();
                    if(searchVal) {
                        searchVal.split(' ').forEach(word => { if(word.length > 2) body.mark(word); });
                    }
                });
            }
        });
    });
</script>

</body>
</html>
