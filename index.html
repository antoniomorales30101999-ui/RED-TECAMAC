<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RED TECAMAC</title>

    <script>
        var claveCorrecta = "Tecamac2026*";
        if (sessionStorage.getItem("acceso_permitido") !== "true") {
            var intento = prompt("üîê ACCESO RESTRINGIDO\nIngrese clave t√©cnica:");
            if (intento === claveCorrecta) { sessionStorage.setItem("acceso_permitido", "true"); }
            else { alert("Acceso denegado"); window.location.href = "https://google.com"; }
        }
    </script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js"></script>

    <style>
        body { background-color: #f4f7f6; color: #333; font-family: 'Segoe UI', sans-serif; padding: 15px; }
        
        .app-header {
            background: linear-gradient(135deg, #004a99 0%, #002d5f 100%);
            color: white;
            padding: 30px 15px;
            border-bottom-left-radius: 25px;
            border-bottom-right-radius: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 30px;
            text-align: center;
        }
        .app-header h1 { font-weight: bold; font-size: 1.6rem; margin: 0; }

        /* BUSCADOR √öNICO CENTRAL */
        .search-wrapper { max-width: 700px; margin: 0 auto 30px auto; }
        #mainSearch {
            background: white;
            border: 2px solid #004a99;
            border-radius: 50px !important;
            padding: 18px 30px !important;
            width: 100% !important;
            font-size: 1.2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            outline: none;
            transition: 0.3s;
        }
        #mainSearch:focus { box-shadow: 0 6px 20px rgba(0,74,153,0.2); border-color: #0056b3; }

        /* TABLA (OCULTA POR DEFECTO) */
        #contenedorTabla { 
            display: none; 
            background: white; 
            border-radius: 20px; 
            padding: 20px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); 
        }
        
        .table thead th { 
            background-color: #f8f9fa !important; 
            color: #004a99 !important; 
            text-transform: uppercase; 
            font-size: 0.75rem; 
            border-bottom: 2px solid #dee2e6 !important; 
        }
        
        mark { background: #fff3cd !important; color: #856404 !important; font-weight: bold; border-radius: 2px; }
        .placeholder-text { text-align: center; color: #adb5bd; margin-top: 80px; font-size: 1.2rem; font-style: italic; }
    </style>
</head>
<body>

<div class="app-header">
    <h1>üõ∞Ô∏è SISTEMA RED TECAMAC</h1>
    <p class="small opacity-75 mb-0">Buscador Universal de Infraestructura</p>
</div>

<div class="search-wrapper">
    <input type="text" id="mainSearch" placeholder="üîç buscar...">
</div>

<div id="mensajeVacio" class="placeholder-text">
    <p>Ingrese par√°metros para filtrar la red...</p>
</div>

<div id="contenedorTabla">
    <table id="tablaMaestra" class="table table-hover w-100">
        <thead>
            <tr>
                <th>Cuenta</th><th>QR</th><th>OLT</th><th>FSP</th>
                <th>Lat</th><th>Lon</th><th>Ubicaci√≥n</th><th>Puerto</th>
            </tr>
        </thead>
    </table>
</div>

<script>
    var table;
    $(document).ready(function() {
        Papa.parse("datos.csv", {
            download: true,
            header: false,
            skipEmptyLines: true,
            complete: function(results) {
                table = $('#tablaMaestra').DataTable({
                    data: results.data,
                    deferRender: true,
                    scrollY: "55vh",
                    scrollCollapse: true,
                    dom: 'rtip',
                    language: { "info": "Registros encontrados: _TOTAL_" }
                });

                $('#mainSearch').on('keyup input', function() {
                    var val = $(this).val().trim();

                    if (val === "") {
                        $('#contenedorTabla').hide();
                        $('#mensajeVacio').show();
                        table.search('').draw();
                    } else {
                        $('#contenedorTabla').show();
                        $('#mensajeVacio').hide();

                        // L√≥gica Inteligente: si hay espacios (como en un log), busca por palabras
                        var query = val.includes(' ') || val.includes('\t') ? 
                                    val.replace(/\t/g, ' ').split(' ').filter(w => w.length > 1).join(' ') : 
                                    val;
                        
                        table.search(query).draw();
                    }
                });

                table.on('draw', function() {
                    var body = $(table.table().body());
                    body.unmark();
                    var searchVal = table.search();
                    if(searchVal) {
                        searchVal.split(' ').forEach(word => { if(word.length > 2) body.mark(word); });
                    }
                });
            }
        });
    });
</script>

</body>
</html>

